<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <style>
        /* ========== WINDOWS XP LUNA THEME ========== */

        :root {
            --xp-blue-dark: #0054E3;
            --xp-blue-medium: #245EDC;
            --xp-blue-light: #3C8CF4;
            --xp-blue-title: #0831D9;
            --xp-green-start: #3C9A3C;
            --xp-silver: #D4D0C8;
            --xp-silver-dark: #808080;
            --xp-silver-light: #FFFFFF;
            --xp-window-bg: #ECE9D8;
            --xp-taskbar: #245EDC;
            --sidebar-width: 200px;
        }

        * {
            font-family: "Tahoma", "Segoe UI", Arial, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #0058E6 0%, #3C8CF4 3%, #5BA3F4 5%, #6EACF4 50%, #5BA3F4 95%, #3C8CF4 97%, #0058E6 100%);
            background-attachment: fixed;
            min-height: 100vh;
            font-size: 11px;
        }

        /* Main Window Container */
        .xp-window {
            margin: 10px;
            background: var(--xp-window-bg);
            border: 1px solid #0054E3;
            border-radius: 8px 8px 0 0;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            min-height: calc(100vh - 20px);
        }

        /* Window Title Bar */
        .xp-titlebar {
            background: linear-gradient(to bottom,
                #0058E6 0%,
                #3C8CF4 8%,
                #4C98F4 20%,
                #3C8CF4 30%,
                #2878E4 80%,
                #0054E3 100%);
            border-radius: 6px 6px 0 0;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 30px;
        }

        .xp-titlebar-text {
            color: white;
            font-weight: bold;
            font-size: 13px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .xp-titlebar-text img, .xp-titlebar-text i {
            width: 16px;
            height: 16px;
        }

        .xp-window-buttons {
            display: flex;
            gap: 2px;
        }

        .xp-btn-window {
            width: 21px;
            height: 21px;
            border: 1px solid rgba(0,0,0,0.3);
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .xp-btn-minimize {
            background: linear-gradient(to bottom, #3C8CF4 0%, #2060D0 100%);
            color: white;
        }

        .xp-btn-maximize {
            background: linear-gradient(to bottom, #3C8CF4 0%, #2060D0 100%);
            color: white;
        }

        .xp-btn-close {
            background: linear-gradient(to bottom, #E48264 0%, #C44030 100%);
            color: white;
        }

        /* Menu Bar */
        .xp-menubar {
            background: var(--xp-window-bg);
            border-bottom: 1px solid #ACA899;
            padding: 2px 4px;
            display: flex;
            gap: 2px;
        }

        .xp-menu-item {
            padding: 2px 8px;
            color: #000;
            text-decoration: none;
            font-size: 11px;
        }

        .xp-menu-item:hover {
            background: var(--xp-blue-dark);
            color: white;
        }

        /* Toolbar */
        .xp-toolbar {
            background: linear-gradient(to bottom, #FAFAFA 0%, #E8E4DB 50%, #D8D4CB 100%);
            border-bottom: 1px solid #ACA899;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .xp-toolbar-btn {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%);
            border: 1px solid #ACA899;
            border-radius: 3px;
            padding: 4px 10px;
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .xp-toolbar-btn:hover {
            background: linear-gradient(to bottom, #FFF8E8 0%, #F8E8C8 100%);
            border-color: #FFC840;
        }

        .xp-toolbar-btn:active {
            background: linear-gradient(to bottom, #E8E4D8 0%, #D8D4CB 100%);
        }

        .xp-toolbar-separator {
            width: 1px;
            height: 22px;
            background: linear-gradient(to bottom, #FFFFFF 0%, #ACA899 50%, #FFFFFF 100%);
            margin: 0 4px;
        }

        /* Main Layout */
        .xp-main {
            display: flex;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar - Task Pane Style */
        .xp-sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(to bottom, #6B98D4 0%, #4878C4 100%);
            border-right: 1px solid #3C68B4;
            padding: 0;
        }

        .xp-task-group {
            margin: 8px;
            background: #FFFFFF;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .xp-task-header {
            background: linear-gradient(to bottom, #FFFFFF 0%, #D4E8FC 100%);
            padding: 6px 10px;
            font-weight: bold;
            font-size: 11px;
            color: #215DC6;
            border-bottom: 1px solid #C4D8F4;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .xp-task-header i {
            color: #215DC6;
        }

        .xp-task-content {
            padding: 4px 0;
        }

        .xp-task-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            color: #215DC6;
            text-decoration: none;
            font-size: 11px;
        }

        .xp-task-link:hover {
            color: #1048A0;
            text-decoration: underline;
        }

        .xp-task-link.active {
            background: #D4E8FC;
            font-weight: bold;
        }

        .xp-task-link i {
            font-size: 14px;
            color: #3078D4;
        }

        /* Content Area */
        .xp-content {
            flex: 1;
            padding: 8px;
            background: #FFFFFF;
            overflow: auto;
        }

        /* Status Bar */
        .xp-statusbar {
            background: linear-gradient(to bottom, #E8E4DB 0%, #D8D4CB 100%);
            border-top: 1px solid #FFFFFF;
            padding: 2px 8px;
            font-size: 11px;
            color: #444;
            display: flex;
            justify-content: space-between;
        }

        .xp-statusbar-section {
            border: 1px inset #D8D4CB;
            padding: 1px 8px;
            background: #F4F4F0;
        }

        /* XP Style Cards/Panels */
        .xp-panel {
            background: #FFFFFF;
            border: 1px solid #ACA899;
            margin-bottom: 10px;
        }

        .xp-panel-header {
            background: linear-gradient(to bottom, #FEFEFE 0%, #E8E4D8 100%);
            border-bottom: 1px solid #ACA899;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 11px;
            color: #333;
        }

        .xp-panel-body {
            padding: 10px;
        }

        /* XP Style Tables */
        .xp-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .xp-table th {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%);
            border: 1px solid #ACA899;
            padding: 4px 8px;
            text-align: left;
            font-weight: bold;
        }

        .xp-table td {
            border: 1px solid #D4D0C8;
            padding: 3px 8px;
        }

        .xp-table tr:nth-child(even) {
            background: #F8F8F4;
        }

        .xp-table tr:hover {
            background: #E8F0FC;
        }

        /* XP Style Buttons */
        .xp-button {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%);
            border: 1px solid #ACA899;
            border-radius: 3px;
            padding: 4px 16px;
            font-size: 11px;
            cursor: pointer;
            font-family: "Tahoma", Arial, sans-serif;
        }

        .xp-button:hover {
            background: linear-gradient(to bottom, #FFF8E8 0%, #F8E8C8 100%);
            border-color: #FFC840;
        }

        .xp-button:active {
            background: linear-gradient(to bottom, #E0DCD4 0%, #C8C4BC 100%);
        }

        .xp-button-primary {
            background: linear-gradient(to bottom, #4890E8 0%, #2060C8 100%);
            border-color: #1050A8;
            color: white;
        }

        .xp-button-primary:hover {
            background: linear-gradient(to bottom, #58A0F8 0%, #3070D8 100%);
        }

        /* XP Style Inputs */
        .xp-input {
            border: 1px solid #7F9DB9;
            padding: 3px 4px;
            font-size: 11px;
            font-family: "Tahoma", Arial, sans-serif;
        }

        .xp-input:focus {
            outline: none;
            border-color: #3C8CF4;
        }

        /* XP Style Alerts */
        .xp-alert {
            border: 1px solid #ACA899;
            padding: 8px 12px;
            margin-bottom: 10px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .xp-alert-info {
            background: #E8F4FC;
            border-color: #A8C8E8;
        }

        .xp-alert-success {
            background: #E8FCE8;
            border-color: #A8E8A8;
        }

        .xp-alert-warning {
            background: #FCFCE8;
            border-color: #E8E8A8;
        }

        .xp-alert-danger {
            background: #FCE8E8;
            border-color: #E8A8A8;
        }

        /* Form groups */
        .xp-form-group {
            margin-bottom: 10px;
        }

        .xp-form-label {
            display: block;
            margin-bottom: 3px;
            font-size: 11px;
            font-weight: normal;
        }

        /* Override Bootstrap for XP look */
        .card {
            border-radius: 0 !important;
            border: 1px solid #ACA899 !important;
            box-shadow: none !important;
        }

        .card-header {
            background: linear-gradient(to bottom, #FEFEFE 0%, #E8E4D8 100%) !important;
            border-bottom: 1px solid #ACA899 !important;
            border-radius: 0 !important;
            padding: 6px 10px !important;
            font-size: 12px !important;
        }

        .card-body {
            padding: 10px !important;
            font-size: 11px !important;
        }

        .btn {
            border-radius: 3px !important;
            font-size: 11px !important;
            padding: 4px 12px !important;
        }

        .btn-primary {
            background: linear-gradient(to bottom, #4890E8 0%, #2060C8 100%) !important;
            border-color: #1050A8 !important;
        }

        .btn-secondary {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%) !important;
            border-color: #ACA899 !important;
            color: #333 !important;
        }

        .btn-outline-primary {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%) !important;
            border-color: #ACA899 !important;
            color: #215DC6 !important;
        }

        .btn-outline-primary:hover {
            background: linear-gradient(to bottom, #E8F4FC 0%, #D4E8FC 100%) !important;
        }

        .form-control {
            border-radius: 0 !important;
            border: 1px solid #7F9DB9 !important;
            font-size: 11px !important;
            padding: 4px 6px !important;
        }

        .form-control:focus {
            box-shadow: none !important;
            border-color: #3C8CF4 !important;
        }

        .table {
            font-size: 11px !important;
        }

        .table th {
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E4D8 100%) !important;
            font-size: 11px !important;
            padding: 4px 8px !important;
        }

        .table td {
            padding: 3px 8px !important;
        }

        .badge {
            border-radius: 2px !important;
            font-size: 10px !important;
        }

        /* Print styles */
        @media print {
            .xp-sidebar, .xp-titlebar, .xp-menubar, .xp-toolbar, .xp-statusbar, .no-print {
                display: none !important;
            }
            .xp-window {
                margin: 0;
                border: none;
                box-shadow: none;
            }
            .xp-content {
                padding: 0;
            }
            body {
                background: white;
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if current_user.is_authenticated %}
    <div class="xp-window">
        <!-- Title Bar -->
        <div class="xp-titlebar">
            <div class="xp-titlebar-text">
                <i class="bi bi-journal-bookmark"></i>
                {{ app_name }} - {% if empresa_actual %}{{ empresa_actual.nombre }}{% else %}Sin Empresa{% endif %}
            </div>
            <div class="xp-window-buttons">
                <button class="xp-btn-window xp-btn-minimize">_</button>
                <button class="xp-btn-window xp-btn-maximize">&#9633;</button>
                <a href="{{ url_for('auth.logout') }}" class="xp-btn-window xp-btn-close" title="Cerrar Sesion">X</a>
            </div>
        </div>

        <!-- Menu Bar -->
        <div class="xp-menubar">
            <a href="{{ url_for('auth.dashboard') }}" class="xp-menu-item">Inicio</a>
            <a href="{{ url_for('cuentas.index') }}" class="xp-menu-item">Cuentas</a>
            <a href="{{ url_for('asientos.index') }}" class="xp-menu-item">Asientos</a>
            <a href="{{ url_for('informes.libro_diario') }}" class="xp-menu-item">Informes</a>
            <a href="{{ url_for('ajustes.indices') }}" class="xp-menu-item">Ajustes</a>
            {% if current_user.is_admin %}
            <a href="{{ url_for('admin.empresas') }}" class="xp-menu-item">Admin</a>
            {% endif %}
        </div>

        <!-- Toolbar -->
        <div class="xp-toolbar">
            <button class="xp-toolbar-btn" onclick="history.back()">
                <i class="bi bi-arrow-left"></i> Atras
            </button>
            <button class="xp-toolbar-btn" onclick="history.forward()">
                <i class="bi bi-arrow-right"></i> Adelante
            </button>
            <div class="xp-toolbar-separator"></div>
            <button class="xp-toolbar-btn" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise"></i> Actualizar
            </button>
            <button class="xp-toolbar-btn" onclick="window.print()">
                <i class="bi bi-printer"></i> Imprimir
            </button>
            <div class="xp-toolbar-separator"></div>
            <a href="{{ url_for('auth.select_empresa') }}" class="xp-toolbar-btn">
                <i class="bi bi-building"></i> Cambiar Empresa
            </a>
        </div>

        <!-- Main Area -->
        <div class="xp-main">
            <!-- Sidebar -->
            <div class="xp-sidebar">
                <div class="xp-task-group">
                    <div class="xp-task-header">
                        <i class="bi bi-house"></i> Navegacion
                    </div>
                    <div class="xp-task-content">
                        <a href="{{ url_for('auth.dashboard') }}" class="xp-task-link {% if request.endpoint == 'auth.dashboard' %}active{% endif %}">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                        <a href="{{ url_for('auth.select_empresa') }}" class="xp-task-link">
                            <i class="bi bi-building"></i> Cambiar Empresa
                        </a>
                    </div>
                </div>

                <div class="xp-task-group">
                    <div class="xp-task-header">
                        <i class="bi bi-journal-text"></i> Contabilidad
                    </div>
                    <div class="xp-task-content">
                        <a href="{{ url_for('cuentas.index') }}" class="xp-task-link {% if request.blueprint == 'cuentas' %}active{% endif %}">
                            <i class="bi bi-list-nested"></i> Plan de Cuentas
                        </a>
                        <a href="{{ url_for('asientos.index') }}" class="xp-task-link {% if request.blueprint == 'asientos' %}active{% endif %}">
                            <i class="bi bi-journal-text"></i> Asientos
                        </a>
                    </div>
                </div>

                <div class="xp-task-group">
                    <div class="xp-task-header">
                        <i class="bi bi-file-text"></i> Informes
                    </div>
                    <div class="xp-task-content">
                        <a href="{{ url_for('informes.libro_diario') }}" class="xp-task-link">
                            <i class="bi bi-file-text"></i> Libro Diario
                        </a>
                        <a href="{{ url_for('informes.libro_mayor') }}" class="xp-task-link">
                            <i class="bi bi-file-earmark-text"></i> Libro Mayor
                        </a>
                        <a href="{{ url_for('informes.sumas_saldos') }}" class="xp-task-link">
                            <i class="bi bi-calculator"></i> Sumas y Saldos
                        </a>
                        <a href="{{ url_for('informes.balance_general') }}" class="xp-task-link">
                            <i class="bi bi-pie-chart"></i> Balance General
                        </a>
                    </div>
                </div>

                <div class="xp-task-group">
                    <div class="xp-task-header">
                        <i class="bi bi-gear"></i> Ajustes
                    </div>
                    <div class="xp-task-content">
                        <a href="{{ url_for('admin.ejercicios') }}" class="xp-task-link">
                            <i class="bi bi-calendar-range"></i> Ejercicios
                        </a>
                        <a href="{{ url_for('ajustes.indices') }}" class="xp-task-link">
                            <i class="bi bi-graph-up"></i> Indices Inflacion
                        </a>
                        <a href="{{ url_for('ajustes.ajustar') }}" class="xp-task-link">
                            <i class="bi bi-sliders"></i> Ajuste por Inflacion
                        </a>
                    </div>
                </div>

                {% if current_user.is_admin %}
                <div class="xp-task-group">
                    <div class="xp-task-header">
                        <i class="bi bi-shield-lock"></i> Administracion
                    </div>
                    <div class="xp-task-content">
                        <a href="{{ url_for('admin.empresas') }}" class="xp-task-link">
                            <i class="bi bi-building"></i> Empresas
                        </a>
                        <a href="{{ url_for('admin.usuarios') }}" class="xp-task-link">
                            <i class="bi bi-people"></i> Usuarios
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Content -->
            <div class="xp-content">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="xp-alert xp-alert-{{ category }}">
                                {% if category == 'success' %}<i class="bi bi-check-circle"></i>
                                {% elif category == 'danger' %}<i class="bi bi-x-circle"></i>
                                {% elif category == 'warning' %}<i class="bi bi-exclamation-triangle"></i>
                                {% else %}<i class="bi bi-info-circle"></i>{% endif %}
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </div>
        </div>

        <!-- Status Bar -->
        <div class="xp-statusbar">
            <span class="xp-statusbar-section">
                <i class="bi bi-person"></i> {{ current_user.nombre or current_user.username }}
            </span>
            <span class="xp-statusbar-section">
                <i class="bi bi-building"></i> {% if empresa_actual %}{{ empresa_actual.codigo }}{% else %}Sin Empresa{% endif %}
            </span>
            <span class="xp-statusbar-section" id="xp-clock">
                <i class="bi bi-clock"></i> --:--
            </span>
        </div>
    </div>
    {% else %}
    <!-- Login page - simple centered -->
    <div class="xp-window" style="max-width: 400px; margin: 50px auto; min-height: auto;">
        <div class="xp-titlebar">
            <div class="xp-titlebar-text">
                <i class="bi bi-journal-bookmark"></i> {{ app_name }} - Iniciar Sesion
            </div>
            <div class="xp-window-buttons">
                <button class="xp-btn-window xp-btn-close">X</button>
            </div>
        </div>
        <div style="background: var(--xp-window-bg); padding: 20px;">
            {% block login_content %}{% endblock %}
        </div>
    </div>
    {% endif %}

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        // Update clock
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('xp-clock').innerHTML = '<i class="bi bi-clock"></i> ' + time;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Initialize DataTables with Spanish language
        $.extend(true, $.fn.dataTable.defaults, {
            language: {
                url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
            },
            pageLength: 20,
            responsive: true
        });

        // Format currency helper
        function formatCurrency(value) {
            return new Intl.NumberFormat('es-AR', {
                style: 'decimal',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
